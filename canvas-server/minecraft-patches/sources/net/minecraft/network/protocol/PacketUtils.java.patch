--- a/net/minecraft/network/protocol/PacketUtils.java
+++ b/net/minecraft/network/protocol/PacketUtils.java
@@ -47,7 +_,11 @@
             };
             // ignore retired state, if removed then we don't want the packet to be handled
             if (processor instanceof net.minecraft.server.network.ServerGamePacketListenerImpl gamePacketListener) {
-                gamePacketListener.player.queuePacketTask(run);
+                // Canvas start - rewrite tick scheduler
+                if (io.canvasmc.canvas.Config.INSTANCE.networking.intermediateTaskHandlingOfPackets) {
+                    gamePacketListener.connection.addPacket(run);
+                } gamePacketListener.player.queuePacketTask(run);
+                // Canvas end
             } else if (processor instanceof net.minecraft.server.network.ServerConfigurationPacketListenerImpl configurationPacketListener) {
                 io.papermc.paper.threadedregions.RegionizedServer.getInstance().addTask(run);
             } else if (processor instanceof net.minecraft.server.network.ServerLoginPacketListenerImpl loginPacketListener) {
